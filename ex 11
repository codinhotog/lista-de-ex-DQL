CREATE TABLE alunos ( 
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, 
    nome VARCHAR2(100) NOT NULL 
);

CREATE TABLE matriculas ( 
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, 
    aluno_id NUMBER NOT NULL, 
    status VARCHAR2(20) NOT NULL, 
    data_matricula DATE NOT NULL, 
    FOREIGN KEY (aluno_id) REFERENCES alunos(id) 
);

INSERT INTO alunos (nome) VALUES ('João Silva');

INSERT INTO alunos (nome) VALUES ('Maria Santos');

INSERT INTO alunos (nome) VALUES ('Pedro Oliveira');

INSERT INTO alunos (nome) VALUES ('Ana Costa');

INSERT INTO alunos (nome) VALUES ('Lucas Lima');

INSERT INTO matriculas (aluno_id, status, data_matricula) VALUES (1, 'Ativo', DATE '2023-05-01');

INSERT INTO matriculas (aluno_id, status, data_matricula) VALUES (2, 'Concluído', DATE '2022-12-15');

INSERT INTO matriculas (aluno_id, status, data_matricula) VALUES (3, 'Trancado', DATE '2023-01-20');

INSERT INTO matriculas (aluno_id, status, data_matricula) VALUES (4, 'Ativo', DATE '2023-03-10');

INSERT INTO matriculas (aluno_id, status, data_matricula) VALUES (5, 'Ativo', DATE '2023-07-25');

SELECT a.nome AS aluno, m.status, m.data_matricula 
FROM alunos a 
JOIN matriculas m ON a.id = m.aluno_id 
ORDER BY  
  CASE  
    WHEN m.status = 'Ativo' THEN 1 
    WHEN m.status = 'Concluído' THEN 2 
    WHEN m.status = 'Trancado' THEN 3 
    ELSE 4 
  END, 
  m.data_matricula DESC;
